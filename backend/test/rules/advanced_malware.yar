import "pe"
import "math"
import "hash"

rule Advanced_Malware_Detection
{
    meta:
        author = "Prashant Suthar"
        description = "Detects advanced malware using static analysis"
        date = "2025-02-22"

    strings:
        $api1 = "VirtualAlloc" ascii
        $api2 = "WriteProcessMemory" ascii
        $packer1 = "UPX" ascii
        $packer2 = "Themida" ascii

    condition:
        uint16(0) == 0x5A4D and
        (any of ($api*) or any of ($packer*) or pe.number_of_sections > 10 or pe.overlay.offset > 0)
}
